---
layout: post
title: "为VLM映射键盘布局"
category: ""
tags: []
date: 2013-11-26 17:12:11 +0800
---
总结并介绍如何利用普通键盘映射出 Lisp Machine 专用键盘，例如Space Cadet Keyboard, 如图：
<img src="{{site.baseurl}}/assets/img/SpaceCadet1.jpeg" class="img-responsive"/>

在宿主Linux系统可以用`xmodmap`命令修改X环境中键盘布局:  
例如`xmodmap -e "keycode 110 = a"`这条命令中，110表示keycode, 而Help表示keysym（即对应的物理按键的“标识”）。整条命令用来设定将传给X环境的keycode 110转化为操作系统认定的a这个物理按键。效果就是：按住键盘上能产生110 keycode的按键，在X环境中，会触发a按键，即显示出“a”字符。  
同理，普通键盘没有Help键、Abort键、Select健等（被映射键），则在X环境中，可以通过将不用的F1~F12等键（待映射键）进行映射。在此，只需知道待映射键的keycode，与被映射健的keysym标识就能完成映射。   

**待映射键的keycode**   

终端利用`xev`工具可以查询当前按键对应的keycode以及对应的keysym值。例如（加粗部分即显示出来的对应值）：
<pre>
KeyRelease event, serial 29, synthetic NO, window 0x3400001,
    root 0x40, subw 0x0, time 7299093, (231,300), root:(236,373),
    state 0x0, <strong>keycode 38</strong> (<strong>keysym 0x61, a</strong>), same_screen YES,
    XLookupString gives 1 bytes: (61) "a"
    XFilterEvent returns: False
</pre>

这样，我们可以找到自己机器上的所有你设置的被映射健的keycode（注意，不太机器，系统不同，键盘布局选择不同都会有区别，这个keycode需要自己手动通过xdev查找）。  

**被映射的keysym**  

那现在如何找到Lisp Machine keyboard中需要被映射的健的keysym呢？   有个好消息，Linux系统默认定义了一个keysym list，其中就包含了大多数需要的keysym。  
首先，在Ubuntu中可以通过`sudo apt-get install x11proto-core-dev`命令安装X11开放环境。
然后，找到`/usr/include/X11/keysymdef.h`文件，其中就包含一系列的keysym。  
利用`grep -i help /usr/include/X11/keysymdef.h`命令就可以查找到Lisp Machine中HELP键的keysym，
<pre>
$ grep -i help /usr/include/X11/keysymdef.h 
<code>#define XK_Help                          0xff6a /* Help */</code>
</pre>

去掉`XK_`，`Help`字符串就是所需要的keysym。
同理，可以找到如下的对应列表：
SELECT: Select
ABORT: Cancel
CLEAR INPUT: Clear
RUBOUT: Delete

**设置映射**  

可以用`xmodmap -e "keycode 110 = a"`这类命令一条条设置。然后用`xmodmap -pke >~/.Xmodmap`命令导出布局，并将`xmodmap .Xmodmap`命令加入到.xinitrc文件中，保证下次自动加载布局。这样就完成了！
不过也可以先导出保存.Xmodmap文件，然后用文本编辑器修改keycode keysym的对应条目。

**参考资料**

http://askubuntu.com/questions/93772/where-do-i-find-a-list-of-all-x-keysyms-these-days
http://wiki.linuxquestions.org/wiki/List_of_Keysyms_Recognised_by_Xmodmap
http://askubuntu.com/questions/24916/how-do-i-remap-certain-keys
https://wiki.archlinux.org/index.php/Xmodmap
http://world.std.com/~jdostale/kbd/SpaceCadet.html
http://stevelosh.com/blog/2012/10/a-modern-space-cadet/

**.Xmodmap参考**

.Xmodmap文件内容（不要copy复制过去用，keycode很可能和你键盘不同，直接使用会布局混乱）：
<pre>
keycode   8 =
keycode   9 = Escape
keycode  10 = 1 exclam
keycode  11 = 2 at
keycode  12 = 3 numbersign
keycode  13 = 4 dollar
keycode  14 = 5 percent
keycode  15 = 6 asciicircum dead_circumflex dead_circumflex dead_circumflex dead_circumflex
keycode  16 = 7 ampersand
keycode  17 = 8 asterisk
keycode  18 = 9 parenleft dead_grave NoSymbol dead_grave
keycode  19 = 0 parenright
keycode  20 = bracketleft braceleft
keycode  21 = bracketright braceright dead_tilde NoSymbol dead_tilde
keycode  22 = Delete
keycode  23 = Tab ISO_Left_Tab
keycode  24 = apostrophe quotedbl dead_acute dead_diaeresis dead_acute dead_diaeresis
keycode  25 = comma less dead_cedilla dead_caron dead_cedilla dead_caron
keycode  26 = period greater dead_abovedot periodcentered dead_abovedot periodcentered
keycode  27 = p P
keycode  28 = y Y
keycode  29 = f F
keycode  30 = g G
keycode  31 = c C
keycode  32 = r R
keycode  33 = l L
keycode  34 = slash question
keycode  35 = equal plus
keycode  36 = Return
keycode  37 = Control_L NoSymbol Control_L
keycode  38 = a A
keycode  39 = o O
keycode  40 = e E
keycode  41 = u U
keycode  42 = i I
keycode  43 = d D
keycode  44 = h H
keycode  45 = t T
keycode  46 = n N
keycode  47 = s S
keycode  48 = minus underscore
keycode  49 = grave asciitilde dead_grave dead_tilde dead_grave dead_tilde
keycode  50 = Shift_L
keycode  51 = backslash bar
keycode  52 = semicolon colon dead_ogonek dead_doubleacute dead_ogonek dead_doubleacute
keycode  53 = q Q
keycode  54 = j J
keycode  55 = k K
keycode  56 = x X
keycode  57 = b B
keycode  58 = m M
keycode  59 = w W
keycode  60 = v V
keycode  61 = z Z
keycode  62 = Shift_R
keycode  63 = KP_Multiply XF86_ClearGrab
keycode  64 = Meta_L
keycode  65 = space
keycode  66 = Caps_Lock
keycode  67 = Help
keycode  68 = Select
keycode  69 = Clear
keycode  70 = Cancel
keycode  71 = F5
keycode  72 = function
keycode  73 = F7 XF86_Switch_VT_7
keycode  74 = F8 XF86_Switch_VT_8
keycode  75 = F9 XF86_Switch_VT_9
keycode  76 = F10 XF86_Switch_VT_10
keycode  77 = Num_Lock Pointer_EnableKeys
keycode  78 = Scroll_Lock
keycode  79 = KP_Home KP_7
keycode  80 = KP_Up KP_8
keycode  81 = KP_Prior KP_9
keycode  82 = KP_Subtract XF86_Prev_VMode
keycode  83 = KP_Left KP_4
keycode  84 = KP_Begin KP_5
keycode  85 = KP_Right KP_6
keycode  86 = KP_Add XF86_Next_VMode
keycode  87 = KP_End KP_1
keycode  88 = KP_Down KP_2
keycode  89 = KP_Next KP_3
keycode  90 = KP_Insert KP_0
keycode  91 = KP_Delete KP_Decimal
keycode  92 =
keycode  93 = Mode_switch
keycode  94 = less greater bar brokenbar bar brokenbar
keycode  95 = F11 XF86_Switch_VT_11
keycode  96 = F12 XF86_Switch_VT_12
keycode  97 = Home
keycode  98 = Up
keycode  99 = Prior
keycode 100 = Left
keycode 101 =
keycode 102 = Right
keycode 103 = End
keycode 104 = Down
keycode 105 = Next
keycode 106 = Insert
keycode 107 = Delete
keycode 108 = KP_Enter
keycode 109 = Control_R
keycode 110 = Pause Break
keycode 111 = Print Sys_Req
keycode 112 = KP_Divide XF86_Ungrab
keycode 113 = ISO_Level3_Shift ISO_Next_Group
keycode 114 =
keycode 115 = Super_L
keycode 116 = Super_R
keycode 117 = Menu
keycode 118 =
keycode 119 =
keycode 120 =
keycode 121 =
keycode 122 =
keycode 123 =
keycode 124 = ISO_Level3_Shift
keycode 125 = NoSymbol Alt_L
keycode 126 = KP_Equal
keycode 127 = NoSymbol Super_L
keycode 128 = NoSymbol Hyper_L
keycode 129 =
keycode 130 =
keycode 131 =
keycode 132 =
keycode 133 =
keycode 134 =
keycode 135 =
keycode 136 =
keycode 137 =
keycode 138 =
keycode 139 =
keycode 140 =
keycode 141 =
keycode 142 =
keycode 143 =
keycode 144 =
keycode 145 =
keycode 146 =
keycode 147 =
keycode 148 =
keycode 149 =
keycode 150 =
keycode 151 =
keycode 152 =
keycode 153 =
keycode 154 =
keycode 155 =
keycode 156 = NoSymbol Meta_L
keycode 157 =
keycode 158 =
keycode 159 =
keycode 160 =
keycode 161 =
keycode 162 =
keycode 163 =
keycode 164 =
keycode 165 =
keycode 166 =
keycode 167 =
keycode 168 =
keycode 169 =
keycode 170 =
keycode 171 =
keycode 172 =
keycode 173 =
keycode 174 =
keycode 175 =
keycode 176 =
keycode 177 =
keycode 178 =
keycode 179 =
keycode 180 =
keycode 181 =
keycode 182 =
keycode 183 =
keycode 184 =
keycode 185 =
keycode 186 =
keycode 187 =
keycode 188 =
keycode 189 =
keycode 190 =
keycode 191 =
keycode 192 =
keycode 193 =
keycode 194 =
keycode 195 =
keycode 196 =
keycode 197 =
keycode 198 =
keycode 199 =
keycode 200 =
keycode 201 =
keycode 202 =
keycode 203 =
keycode 204 =
keycode 205 =
keycode 206 =
keycode 207 =
keycode 208 =
keycode 209 =
keycode 210 =
keycode 211 =
keycode 212 =
keycode 213 =
keycode 214 =
keycode 215 =
keycode 216 =
keycode 217 =
keycode 218 =
keycode 219 =
keycode 220 =
keycode 221 =
keycode 222 =
keycode 223 =
keycode 224 =
keycode 225 =
keycode 226 =
keycode 227 =
keycode 228 =
keycode 229 =
keycode 230 =
keycode 231 =
keycode 232 =
keycode 233 =
keycode 234 =
keycode 235 =
keycode 236 =
keycode 237 =
keycode 238 =
keycode 239 =
keycode 240 =
keycode 241 =
keycode 242 =
keycode 243 =
keycode 244 =
keycode 245 =
keycode 246 =
keycode 247 =
keycode 248 =
keycode 249 =
keycode 250 =
keycode 251 =
keycode 252 =
keycode 253 =
keycode 254 =
keycode 255 =
</pre>

